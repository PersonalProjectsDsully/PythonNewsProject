import requests
from bs4 import *
import sqlite3


def TextNews():
    source1 = requests.get('https://www.darkreading.com/rss.xml')
    soup1s = BeautifulSoup(source1.content, features='xml')
    articles = soup1s.findAll('item')
    i = 0

    for article in articles:
        link = article.link.text
        headline = article.title.text
        description = article.description.text
        date = article.pubDate.text
        date = (str(date))
        link = (str(link))
        headline = (str(headline))
        description = (str(description))
        print(headline)
        i = i + 1
        insertintodatabase(link, description, headline, date)


def telegram_bot_sendtext(bot_message):
    bot_token = ''
    bot_chatID = ''
    send_text = 'https://api.telegram.org/bot' + bot_token + '/sendMessage?chat_id=' + bot_chatID + '&parse_mode=Markdown&text=' + bot_message
    response = requests.get(send_text)
    return response.json()


def insertintodatabase(link, description, headline, date):
    conn = sqlite3.connect('news.db')
    c = conn.cursor()
    parameters = (headline, description, date, link)
    c.execute("INSERT OR IGNORE INTO news VALUES(?,?,?,?)", parameters)
    conn.commit()
    if c.rowcount == 1:
        telegram_bot_sendtext(headline + description + date + link)
        print(c.rowcount, headline, "was inserted.")
    c.execute("SELECT * FROM news")
    conn.close()


TextNews()
